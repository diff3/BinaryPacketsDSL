# SMSG_MESSAGECHAT - Partial, needs testing
endian: little
header:

data:
    # -------------------------------
    # FLAG SECTION 1
    # -------------------------------
    hasSenderName_neg:     bits, 1B
    hideInChatLog:         bits, 1B
    senderName_len:        bits, 11I   

    fake_0:                bits, 1B
    hasChannelName_neg:    bits, 1B
    unk_bit_0:             bits, 1B
    hasFakeTime:           bits, 1B
    hasChatTag_neg:        bits, 1B
    realmFlag1:            bits, 1B

    # -------------------------------
    # GROUP GUID MASK (bit order fixed)
    # -------------------------------
    group_guid_mask: bits, 8B, list
        # order:
        # 0,1,5,4,3,2,6,7

    # chatTag? (9 bits)
    chatTag: bits, 9I 

    # -------------------------------
    # RECEIVER GUID BIT MASK
    # -------------------------------
    receiver_guid_mask: bits, 8B, list
        # order:
        # 7,6,1,4,0,2,3,5

    fake_1:             bits, 1B
    hasLanguage_neg:    bits, 1B
    hasPrefix_neg:      bits, 1B

    # -------------------------------
    # SENDER GUID MASK
    # -------------------------------
    sender_guid_mask: bits, 8B, list
        # order:
        # 0,3,7,2,1,5,4,6

    hasAchievement_neg: bits, 1B
    hasMessage_neg:     bits, 1B

    channelName_len: bits, 7I  
    message_len:     bits, 12I 

    hasReceiverName_neg: bits, 1B
    receiverName_len: bits, 11I

    prefix_len: bits, 5I

    realmFlag2: bits, 1B

    # -------------------------------
    # GUILD GUID MASK
    # -------------------------------
    guild_guid_mask: bits, 8BI
        # order:
        # 2,5,7,4,0,1,3,6

    # END OF BIT SECTION
    # -------------------------------
    flush_bits: none

    # -------------------------------
    # Now follow BYTE SEQUENCES
    # GUID bytes appear in permuted order
    # -------------------------------

   #- guild_guid_bytes: 1B[8] | MGuidSeq(guild_guid_mask, [4,5,7,3,2,6,0,1])

    channel_name:     €channelName_len's 
    prefix:           €prefix_len's      

    sender_guid_bytes: 1B[8] | MGuidSeq(sender_guid_mask, [4,7,1,5,0,6,2,3])

    chat_type: 1B

    achievement_id: 4L

    group_guid_bytes: 1B[8] | MGuidSeq(group_guid_mask, [1,3,4,6,0,2,5,7])

    receiver_guid_bytes: 1B[8] | MGuidSeq(receiver_guid_mask, [2,5,3,6,7,4,1,0])

    language: 1B 

    message: €message_len's

    receiver_name: €receiverName_len's
    sender_name:   €senderName_len's  --#